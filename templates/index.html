<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>לימוד מילים באנגלית</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <h1>אתר לימוד מילים באנגלית 📘</h1>

    <!-- יצירת רשימה חדשה -->
    <section>
      <h2>➕ יצירת רשימה חדשה</h2>
      <input id="newListName" placeholder="שם הרשימה" />
      <button id="createBtn">צור רשימה</button>
    </section>

    <!-- כל הרשימות -->
    <section>
      <h2>📄 הרשימות שלך</h2>
      <div id="lists"></div>
    </section>

    <hr/>

    <!-- ניהול רשימה -->
    <section id="manage" style="display:none;">
      <h2>ניהול רשימה: <span id="mListName"></span> (עד 15 מילים)</h2>

      <div class="row">
        <input id="en" placeholder="English" />
        <input id="he" placeholder="עברית" />
        <button onclick="addWord()">הוסף מילה</button>
      </div>

      <ul id="words"></ul>
      <button onclick="startQuiz('en2he')">תרגול אנגלית ➝ עברית</button>
      <button onclick="startQuiz('he2en')">תרגול עברית ➝ אנגלית</button>
      <button class="secondary" onclick="backToLists()">חזרה לרשימות</button>
    </section>

    <hr/>

    <!-- חידון -->
    <section id="quiz" style="display:none;">
      <h2>חידון: <span id="qListName"></span></h2>
      <div id="qNumber"></div>
      <div id="qPrompt"></div>
      <input id="qAnswer" placeholder="התשובה שלך" onkeydown="if(event.key==='Enter') checkAnswer()" />
      <button onclick="checkAnswer()">בדוק</button>
      <div id="qFeedback"></div>
      <button class="secondary" onclick="showManage()">סיום חידון</button>
    </section>
  </div>

<script>
  // ===== טעינה ראשונית =====
  document.addEventListener("DOMContentLoaded", () => {
    loadLists();
    document.getElementById("createBtn").addEventListener("click", createList);
  });

  // ===== רשימות =====
  async function loadLists() {
    try {
      const r = await fetch("/api/lists");
      if (!r.ok) throw new Error("בעיה בתקשורת עם השרת");
      const js = await r.json();
      const cont = document.getElementById("lists");
      cont.innerHTML = "";
      js.lists.forEach(li => {
        const row = document.createElement("div");
        row.className = "list-row";
        row.innerHTML = `
          <div class="list-name">${li.name}</div>
          <div class="list-stats">מילים: ${li.count} | ✅ ${li.ok} | ❌ ${li.bad}</div>
          <div class="list-actions">
            <button onclick="manage('${li.name}')">נהל</button>
          </div>
        `;
        cont.appendChild(row);
      });
    } catch (err) {
      alert("שגיאה בטעינת רשימות:\n" + err.message);
    }
  }

  async function createList() {
    const name = document.getElementById("newListName").value.trim();
    if (!name) return alert("נא להזין שם לרשימה");

    try {
      const r = await fetch("/api/lists", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name })
      });

      const js = await r.json();
      if (!js.ok) {
        alert(js.error || "שגיאה בהוספת הרשימה");
        return;
      }

      document.getElementById("newListName").value = "";
      alert("הרשימה נוספה בהצלחה!");
      loadLists();
    } catch (err) {
      alert("שגיאה בעת יצירת רשימה:\n" + err.message);
    }
  }

  // ===== ניהול מילים =====
  let currentList = null;
  let currentWords = [];

  async function manage(name) {
    currentList = name;
    document.getElementById("mListName").innerText = name;
    document.getElementById("manage").style.display = "";
    document.getElementById("quiz").style.display = "none";
    await refreshWords();
  }

  async function refreshWords() {
    const r = await fetch(`/api/list/${encodeURIComponent(currentList)}`);
    const js = await r.json();
    currentWords = js.words || [];
    const ul = document.getElementById("words");
    ul.innerHTML = "";
    currentWords.forEach(w => {
      const li = document.createElement("li");
      li.textContent = `${w.en} — ${w.he} (✅${w.ok||0} ❌${w.bad||0})`;
      ul.appendChild(li);
    });
  }

  async function addWord() {
    const en = document.getElementById("en").value.trim();
    const he = document.getElementById("he").value.trim();
    if (!en || !he) return alert("נא למלא את שתי השדות");

    const r = await fetch("/api/words", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ list: currentList, en, he })
    });
    const js = await r.json();
    if (!js.ok) return alert(js.error || "שגיאה");
    document.getElementById("en").value = "";
    document.getElementById("he").value = "";
    refreshWords();
    loadLists();
  }

  // ===== חזרה =====
  function backToLists() {
    document.getElementById("manage").style.display = "none";
    document.getElementById("quiz").style.display = "none";
    loadLists();
  }
</script>
</body>
</html>
